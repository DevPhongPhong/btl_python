<!doctype html>
<html class="no-js" lang="">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Ranna | Submit Recipes</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Favicon -->
    <link rel="shortcut icon" href="/static/img/favicon.png">
    <!-- Normalize Css -->
    <link rel="stylesheet" href="/static/css/normalize.css">
    <!-- Main Css -->
    <link rel="stylesheet" href="/static/css/main.css">
    <!-- Bootstrap Css -->
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <!-- Animate CSS -->
    <link rel="stylesheet" href="/static/css/animate.min.css">
    <!-- Fontawesome CSS -->
    <link rel="stylesheet" href="/static/css/fontawesome-all.min.css">
    <!-- Flaticon CSS -->
    <link rel="stylesheet" href="/static/fonts/flaticon.css">
    <!-- Summernote CSS -->
    <link rel="stylesheet" href="/static/css/summernote.css">
    <!-- Owl Carousel CSS -->
    <link rel="stylesheet" href="/static/css/owl.carousel.min.css">
    <link rel="stylesheet" href="/static/css/owl.theme.default.min.css">
    <!-- Select 2 CSS -->
    <link rel="stylesheet" href="/static/css/select2.min.css">
    <!-- Custom Css -->
    <link rel="stylesheet" href="/static/style.css">
    <!-- Modernizr Js -->
    <script src="/static/js/modernizr-3.6.0.min.js"></script>
    <!-- Jquery Js -->
    <script src="/static/js/jquery-3.3.1.min.js"></script>
</head>

<body>
    <header class="header-one">
        <div id="header-main-menu" class="header-main-menu header-sticky">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-md-3 col-sm-4 col-4 possition-static">
                        <div class="site-logo-mobile">
                            <a href="/" class="sticky-logo-light"><img src="/static/img/Food-com-logo.png"
                                    style="max-height: 40px;" alt="Site Logo"></a>
                            <a href="/" class="sticky-logo-dark"><img src="/static/img/Food-com-logo.png"
                                    style="max-height: 40px;" alt="Site Logo"></a>
                        </div>
                        <nav class="site-nav">
                            <ul id="site-menu" class="site-menu">
                                <li><button onclick="logout()">Đăng xuất</button>
                                </li>
                                <li>
                                    <a href="/admin/home">Home</a>
                                </li>
                                <li>
                                    <a href="/admin/submitpost">Đăng bài</a>
                                </li>
                                <li><a href="/admin/submitcategory">Tạo danh mục</a>

                                </li>
                            </ul>
                        </nav>
                        <script>
                            logout=()=>{
                                $.ajax({
                                    url:'/api/logout',
                                    success:()=>{
                                        localStorage.clear()
                                        window.location.href='/admin/login'
                                    }
                                })
                            }
                            post=()=>{
                                window.location.href='/admin/submitpost'
                            }
                            category=()=>{
                                window.location.href='/admin/submitcategory'
                            }
                        </script>
                    </div>
                    <div class="col-lg-4 col-md-9 col-sm-8 col-8 d-flex align-items-center justify-content-end">
                        <div class="nav-action-elements-layout1">
                            <ul>
                                <li id="btl_loginShow">
                                   
                                </li>
                            </ul>
                        </div>
                        <div class="mob-menu-open toggle-menu">
                            <span class="bar"></span>
                            <span class="bar"></span>
                            <span class="bar"></span>
                            <span class="bar"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="header-bottom d-none d-lg-block">
            <div class="container">
                <div class="row">
                    <div class="col-lg-4 d-none d-lg-block">
                        <div class="nav-action-elements-layout2">
                        </div>
                    </div>
                    <div class="col-lg-4 d-none d-lg-block">
                        <div class="site-logo-desktop">
                            <a href="/" class="main-logo"><img src="/static/img/Food-com-logo.png" alt="Site Logo"
                                    style="max-height: 60px;"></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>  
    <a href="#wrapper" data-type="section-switch" class="scrollup">
        <i class="fas fa-angle-double-up"></i>
    </a>
      
    <div id="wrapper" class="wrapper">
         

        <!-- Inne Page Banner Area Start Here -->
        <section class="inner-page-banner bg-common" data-bg-image="/static/img/figure/inner-page-banner1.jpg">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="breadcrumbs-area">
                            <h1>Sửa post</h1>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- Inne Page Banner Area End Here -->
        <!-- Submit Recipe Area Start Here -->
        <section class="submit-recipe-page-wrap padding-top-74 padding-bottom-50">
            <div class="container">
                <div class="row gutters-60">
                    <div class="col-lg-8">
                        <form class="submit-recipe-form">
                            <div class="form-group">
                                <label>Title</label>
                                <input id="btl_title"type="text" placeholder="Title" class="form-control" name="name"
                                    data-error="Thêm Title" required>
                                <div class="help-block with-errors"></div>
                            </div>
                            <div class="form-group">
                                <label>Sub Content</label>
                                <input id="btl_sub_content"type="text" placeholder="Sub Content" class="form-control" name="name"
                                    data-error="Thêm sub content" required>
                                <div class="help-block with-errors"></div>
                            </div>
                            <div class="form-group">
                                <label>Main Image</label>
                                <input id="btl_mainImage" accept="image/*" type="file" placeholder="Main Image" class="form-control" name="name"
                                    data-error="Thêm ảnh" required>
                                <img id="btl_mainImage_img"src=""/>
                                <div class="help-block with-errors"></div>
                                <script>
                                    const fileUpload = document.querySelector("#btl_mainImage");
                                    const reader = new FileReader();
                                    fileUpload.addEventListener("change", (event) => {
                                        const files = event.target.files;
                                        reader.readAsDataURL(files[0])
                                        reader.addEventListener("load", (event) => {
                                            const img = event.target.result;
                                            document.getElementById('btl_mainImage_img').src = img
                                        })
                                    })
                                </script>
                            </div>
                            <div class="form-group">
                                <label>Choose Category</label>
                                <select id="btl_select_cate"class="select2" name="filter-by">
                                    <option value="0">Breakfast</option>
                                </select>
                                <script>
                                    $.ajax({
                                        url: '/api/category',
                                        type: 'GET',
                                        success: function (data) {
                                            const btl_select_cate = document.getElementById('btl_select_cate')
                                            btl_select_cate.innerHTML = ''
                                            for (i = 0; i < data.length; i++) {
                                                btl_select_cate.innerHTML += `<option value="${data[i].id[0]}">${data[i].name[0]}</option>`
                                            }
                                        }
                                    })
                                    
                                </script>
                            </div>
                            <div class="form-group">
                                <label>Full Content</label>
                                <div class="summernote"></div>
                            </div>

                            <button type="button" class="btn-submit" onclick="postpost()">Đăng bài</button>
                        </form>
                    </div>

                </div>
            </div>
        </section>
        <!-- Submit Recipe Area End Here -->
        <!-- Footer Area Start Here -->
        <footer class="ranna-bg-dark">
            <div class="container">
                <div class="footer-logo">
                    <a href="/"><img src="/static/img/logo-light.png" class="img-fluid" alt="footer-logo"></a>
                </div>
                    
                <div class="copyright">© All Right Reserved 2022</div>
            </div>
        </footer>
        <!-- Footer Area End Here -->
    </div>
      
    <!-- Modal Start-->
    <div class="modal fade" id="myModal" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="title-default-bold mb-none">Login</div>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <form class="login-form" method ="post">
                        <input class="main-input-box" type="text"  placeholder="Tên tài khoản" />
                        <input class="main-input-box" type="password"  placeholder="Mật khẩu" />
                        <div class="inline-box mb-5 mt-4">
                            <div class="checkbox checkbox-primary">
                                <input id="modal-checkbox" type="checkbox">
                                <label for="modal-checkbox">Nhớ tài khoản</label>
                            </div>
                        </div>
                        <div class="inline-box mb-5 mt-4">
                            <button class="btn-fill" type="submit" value="Login">Đăng nhập</button>
                        </div>
                    </form>
                     
                </div>
            </div>
        </div>
    </div>
    <!-- Modal End-->
    
    <!-- Bootstrap Js -->
    <script src="/static/js/popper.min.js"></script>
    <!-- Bootstrap Js -->
    <script src="/static/js/bootstrap.min.js"></script>
    <!-- Plugins Js -->
    <script src="/static/js/plugins.js"></script>
    <!-- Owl Carousel Js -->
    <script src="/static/js/owl.carousel.min.js"></script>
    <!-- Summernote JS -->
    <script src="/static/js/summernote.min.js"></script>
    <!-- Select 2 Js -->
    <script src="/static/js/select2.full.min.js"></script>
    <!-- Smoothscroll Js -->
    <script src="/static/js/smoothscroll.min.js"></script>
    <!-- Custom Js -->
    <script src="/static/js/main.js"></script>
    <script>
        id=parseInt(location.pathname.substring(18,location.pathname.length))

        $.ajax({
            url:`/api/post/${id}`,
            success: (res)=>{
                document.getElementById('btl_title').value = res.title;
                document.getElementById('btl_sub_content').value = res.sub_content[0];
                document.getElementsByClassName('note-editable')[0].innerHTML = res.full_content[0];
                document.getElementById('btl_mainImage_img').src = res.main_image[0] ;
            }
        })

        postpost=()=>{
            var today = new Date();
            var dd = String(today.getDate()).padStart(2, '0');
            var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
            var yyyy = today.getFullYear();

            today = yyyy + '-' + mm + '-' + dd;

            form = {
                
                title: document.getElementById('btl_title').value,
                sub_content: document.getElementById('btl_sub_content').value,
                full_content: document.getElementsByClassName('note-editable')[0].innerHTML,
                main_image: document.getElementById('btl_mainImage_img').src,
                image: document.getElementById('btl_mainImage').value,
                author: localStorage['username'],
                viewcount: 0,
                created_time: today,
                category: document.getElementById('btl_select_cate').options[document.getElementById('btl_select_cate').selectedIndex].text,  
                tag:'tag',
                id_category: parseInt(document.getElementById('btl_select_cate').value)
            };
            $.ajax({
                url:`/api/post/update/${id}`,
                data:JSON.stringify(form),
                dataType:'json',
                contentType:'application/json',
                type:'PUT',
                success:(res)=>{
                    alert("Đã sửa!")
                    window.location.href='/admin/home'
                }
            })
        }
        
    </script>
</body>



</html>